{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Edit Your Review</title>
{% endblock meta %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h3 class="text-2xl font-semibold mb-4">Edit Review</h3>
    <form id="editReviewForm" action="{% url 'review:edit_review_ajax' review.id %}" method="post">
        {% csrf_token %}
        
        <!-- Title Field -->
        <label for="judul_ulasan" class="block text-gray-700">Title</label>
        <input type="text" id="judul_ulasan" name="judul_ulasan" value="{{ review.judul_ulasan }}" 
               class="w-full p-2 mb-4 border rounded-lg" placeholder="Enter review title" required>

        <!-- Text Field -->
        <label for="teks_ulasan" class="block text-gray-700">Review Text</label>
        <textarea id="teks_ulasan" name="teks_ulasan" rows="4" 
                  class="w-full p-2 mb-4 border rounded-lg" placeholder="Write your review" required>{{ review.teks_ulasan }}</textarea>

        <!-- Rating Field -->
        <label for="penilaian" class="block text-gray-700">Rating</label>
        <input type="number" id="penilaian" name="penilaian" value="{{ review.penilaian }}" min="1" max="5" 
               class="w-full p-2 mb-4 border rounded-lg" placeholder="1 to 5" required>

        <!-- Submit Button -->
        <div class="flex justify-end">
            <button type="button" onclick="closeModal()" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Cancel</button>
            <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded">Save Changes</button>
        </div>
    </form>
</div>

<script>
    // Submit edited review via AJAX
    document.getElementById("editReviewForm").addEventListener("submit", function(event) {
        event.preventDefault();
        
        const formData = new FormData(this);
        
        fetch(`/review/edit/ajax/${currentReviewId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "updated") {
                alert("Review updated successfully!");
                closeModal();
                location.reload(); // Reload page to update review content
            } else {
                alert("Failed to update review. Please try again.");
            }
        })
        .catch(error => console.error("Error:", error));
    });
</script>

{% endblock content %}
