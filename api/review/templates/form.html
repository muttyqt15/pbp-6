<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Penilaian Bintang -->
    <div class="rating-section mb-4">
        <label for="penilaian" class="block text-sm font-medium text-gray-700 mb-2">How was your food?</label>
        <div class="stars" id="stars">
            <span data-value="1">&#9733;</span>
            <span data-value="2">&#9733;</span>
            <span data-value="3">&#9733;</span>
            <span data-value="4">&#9733;</span>
            <span data-value="5">&#9733;</span>
        </div>
        <input type="hidden" id="penilaian" name="penilaian">
    </div>

    <!-- Ulasan -->
    <div class="mb-4">
        <label for="teks_ulasan" class="block text-sm font-medium text-gray-700 mb-2">What's on your mind?</label>
        <textarea id="teks_ulasan" name="teks_ulasan" rows="4" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Share your experience..."></textarea>
    </div>

    <!-- Upload Gambar -->
    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Upload Images (Optional)</label>
        <input type="file" name="gambar" id="gambar" class="mt-2 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer focus:outline-none" accept="image/*" multiple>
        <div id="image-preview" class="mt-2 flex space-x-2"></div>
    </div>

    <!-- Opsi Anonim atau Tidak -->
    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
        <div class="flex items-center mb-2">
            <input id="display_name" name="display_option" type="radio" value="name" class="h-4 w-4 text-yellow-500 focus:ring-yellow-500">
            <label for="display_name" class="ml-3 block text-sm font-medium text-gray-700">Display With Your Name</label>
        </div>
        <div class="flex items-center">
            <input id="display_anonymous" name="display_option" type="radio" value="anonymous" class="h-4 w-4 text-yellow-500 focus:ring-yellow-500">
            <label for="display_anonymous" class="ml-3 block text-sm font-medium text-gray-700">Display Anonymously</label>
        </div>
    </div>

    <!-- Tombol Submit -->
    <div>
        <button type="submit" id="submit-btn" class="w-full bg-gray-400 text-white font-bold py-2 px-4 rounded" disabled>
            Submit Review
        </button>
    </div>
</form>

<!-- Tombol untuk Kembali ke Halaman Utama Review -->
<div class="mt-4 text-center">
    <a href="{% url 'review:main_review' %}" class="bg-yellow-500 text-white py-2 px-4 rounded hover:bg-yellow-600 transition duration-300">Back to Reviews</a>
</div>

<!-- Script untuk interaktif bintang dan submit -->
<script>
    const stars = document.querySelectorAll('#stars span');
    const ratingInput = document.getElementById('penilaian');
    const reviewForm = document.querySelector('form');
    const submitBtn = document.getElementById('submit-btn');
    const imageInput = document.getElementById('gambar');
    const imagePreview = document.getElementById('image-preview');

    // Interaksi bintang hover dan klik
    stars.forEach((star, index) => {
        star.addEventListener('click', () => {
            ratingInput.value = star.getAttribute('data-value');
            stars.forEach((otherStar, otherIndex) => {
                if (otherIndex <= index) {
                    otherStar.classList.add('active');
                } else {
                    otherStar.classList.remove('active');
                }
            });
        });

        star.addEventListener('mouseover', () => {
            stars.forEach((otherStar, otherIndex) => {
                if (otherIndex <= index) {
                    otherStar.classList.add('hover');
                } else {
                    otherStar.classList.remove('hover');
                }
            });
        });

        star.addEventListener('mouseout', () => {
            stars.forEach(otherStar => otherStar.classList.remove('hover'));
        });
    });

    // Memastikan form sudah terisi lengkap (kecuali gambar)
    function checkFormCompletion() {
        const ratingSelected = ratingInput.value !== "";
        const teksUlasanFilled = document.getElementById('teks_ulasan').value.trim() !== "";
        const displayOptionChecked = document.querySelector('input[name="display_option"]:checked');

        if (ratingSelected && teksUlasanFilled && displayOptionChecked) {
            submitBtn.disabled = false;
            submitBtn.classList.add('bg-yellow-500');
            submitBtn.classList.remove('bg-gray-400');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('bg-gray-400');
            submitBtn.classList.remove('bg-yellow-500');
        }
    }

    // Setiap perubahan input, jalankan checkFormCompletion
    reviewForm.addEventListener('input', checkFormCompletion);

    // Preview gambar yang di-upload
    imageInput.addEventListener('change', function() {
        imagePreview.innerHTML = '';
        const files = this.files;
        for (let i = 0; i < files.length; i++) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(files[i]);
            img.className = "w-20 h-20 m-2 rounded";
            imagePreview.appendChild(img);
        }
    });
</script>

<!-- Tambahkan CSS untuk styling bintang -->
<style>
    .stars span {
        font-size: 2em;
        cursor: pointer;
        color: lightgray;
        transition: color 0.3s;
    }

    .stars span.active {
        color: gold;
    }

    .stars span.hover {
        color: gold;
    }
</style>
